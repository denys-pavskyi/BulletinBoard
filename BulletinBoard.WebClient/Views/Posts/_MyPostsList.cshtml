@using BulletinBoard.WebClient.Data
@model List<BulletinBoard.WebClient.Models.Posts.PostViewModel>
@using BulletinBoard.WebClient.Data

@{
    var categories = CategoryData.Categories;
}

@foreach (var item in Model)
{
    var subcategory = categories.SelectMany(c => c.Subcategories).FirstOrDefault(sc => sc.Id == item.SubcategoryId);
    var category = categories.FirstOrDefault(c => c.Subcategories.Any(sc => sc.Id == item.SubcategoryId));

    if (subcategory != null && category != null)
    {
        item.SubcategoryName = subcategory.Name;
        item.CategoryName = category.Name;
    }

    <div class="card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">@item.Title</h5>
                <span class="badge @(item.IsActive ? "bg-success" : "bg-danger")">
                    @(item.IsActive ? "Active" : "Inactive")
                </span>
            </div>
            <p class="card-text">
                @(item.Description.Length > 150 ? item.Description.Substring(0, 150) + "..." : item.Description)
            </p>
            <div class="d-flex justify-content-between align-items-center mb-1 text-muted">
                <small>@item.CreatedDate.ToShortDateString()</small>
                <span class="badge bg-secondary">
                    <i class="bi bi-tags-fill me-1"></i>
                    @item.CategoryName / @item.SubcategoryName
                </span>
            </div>
            <div class="d-flex justify-content-end">
                <button class="btn btn-primary me-2" onclick="window.location.href='/Posts/Edit/@item.Id'">Edit</button>
                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" data-post-id="@item.Id">Delete</button>
            </div>
        </div>
    </div>
}