@model BulletinBoard.WebClient.Models.Posts.MyPostsViewModel
@{
    Layout = "_Layout";
}

@{
    ViewData["Title"] = "My Posts";
}

<a href="/Posts/Create" class="btn btn-primary mb-3">
    Create New Post
</a>

<!-- Container for dynamic list -->
<div class="col-md-9">
    <div id="posts-list">
        @await Html.PartialAsync("_MyPostsList", Model.Posts)
    </div>
</div>

<!-- Modal for Delete Confirmation -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this post?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.btn-danger').forEach(button => {
        button.addEventListener('click', function () {
            var postId = this.getAttribute('data-post-id');
            document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
                deletePost(postId);
            });
        });
    });

    function deletePost(postId) {
        fetch(`/api/posts/delete/${postId}`, { method: 'DELETE' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Post deleted successfully');
                    location.reload();
                } else {
                    alert('Error deleting post');
                }
            });
    }
</script>